<!doctype html>

<html lang="en">
<head>
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Lato:300,400">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/index.css">

<script src="libs/handlebars.runtime-v4.0.5.js"></script>
<script src="js/partials.js"></script>
<script src="js/templates.js"></script>

<meta name="viewport" content="width=device-width" />

<title>Kevin Beaulieu</title>

</head>

<body>
    <script type="text/javascript">
        document.body.innerHTML += Handlebars.templates.index();

        /*
         * On page load
         */
        var canvas = document.getElementById("intro-shapes");
        var context = canvas.getContext('2d');
        var shapes = new Array();
        var shapeInitialDensity = 0.04;
        var spawnRate = 0.03;
        var startShapes = 0;

        window.onload = function() {
            resize();

            // Randomly spawn shapes
            startShapes = shapeInitialDensity * canvas.width;
            for(var i = 0; i < startShapes; i++) {
                spawnShape(false);
            }
        };

        window.onresize = resize;

		function resize() {
			// Set up canvas
			canvas.height = window.innerHeight * 0.8;
		}

        // function goToArticleAfterDelay(article) {
        //     setTimeout(function() {
        //         window.location.href = "http://www.kevinmbeaulieu.com/" + article;
        //     }, 250);
        // }

        function Hexagon(x, y, depth, dir, angle, angspeed) {
            this.x = x;
            this.y = y;
            this.depth = depth;
            this.dir = dir;
            this.angle = angle;
            this.angspeed = angspeed;
        }

        function drawHexagon(h) {
            var numberOfSides = 6;

            var size = (1 - h.depth) * 10 + 5;

            context.beginPath();
            context.moveTo (h.x +  size * Math.cos(h.angle), h.y + size *  Math.sin(h.angle));

            for (var i = 1; i <= numberOfSides; i++) {
                context.lineTo (h.x + size * Math.cos(i * 2 * Math.PI / numberOfSides + h.angle),
                    h.y + size * Math.sin(i * 2 * Math.PI / numberOfSides + h.angle));
            }

            var alpha = 0.5 - h.depth * h.depth;
            context.strokeStyle = "rgba(147, 148, 152, " + alpha + ")";
            context.lineWidth = 1;
            context.stroke();
        }

        function spawnShape(atTop) {
            var depth = Math.random();
            var dir = -Math.PI / 2;//Math.random()*Math.PI/2 + Math.PI*5/4;
            var angle = Math.random()*2*Math.PI;
            var angspeed = Math.random()*0.01;
            var size = (1 - depth) * 10 + 5;
            var position = {
                x: Math.random() * (canvas.width - 60) + 30,
                y: atTop ? (-size - 5) : (Math.random() * canvas.height)
            };

            shapes.push(new Hexagon(position.x, position.y, depth, dir, angle, angspeed));
        }

        window.requestAnimFrame = (function(callback) {
            return window.requestAnimationFrame || window.webkitRequestAnimationFrame
                || window.mozRequestAnimationFrame || window.oRequestAnimationFrame
                || window.msRequestAnimationFrame ||
                function(callback) {
                    window.setTimeout(callback, 1000 / 60);
                };
        })();

        function animate() {
            if(Math.random() < spawnRate) spawnShape(true);

            // Clear
            context.save();
            context.setTransform(1, 0, 0, 1, 0, 0);
            context.clearRect(0, 0, canvas.width, canvas.height);
            context.restore();

            // Draw shapes
            for(var i = 0; i < shapes.length; i++) {
                var shape = shapes[i];
                drawHexagon(shape);

                var speed = (1 - shape.depth * shape.depth) / 3 + 0.1;
                shape.x += speed * Math.cos(shape.dir);
                shape.y -= speed * Math.sin(shape.dir);

                shape.angle += shape.angspeed;

                var size = (1 - shape.depth) * 10 + 5;
                if(shape.x < -size - 6 || shape.x > canvas.width + size + 6 ||
                        shape.y < -size - 6 || shape.y > canvas.height + size + 6) {
                    shapes.splice(i, 1);
                    i--;
                }
            }

            // Draw gradient mask
            var mask = context.createLinearGradient(0, canvas.height - 100, 0, canvas.height);
            mask.addColorStop(0, "rgba(255, 255, 255, 0)");
            mask.addColorStop(1, "rgba(255, 255, 255, 255)");

            context.fillStyle = mask;
            context.fillRect(0, canvas.height - 100, canvas.width, 100);

            // Request new frame
            requestAnimFrame(animate);
        }

        animate();
    </script>

</body>

</html>
