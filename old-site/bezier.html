<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>Untitled 1</title>
<script type="text/javascript" src="jquery-2.1.0.min.js"></script>
</head>

<body style="background-color:#55FFFF">

	<canvas id="bezier-canvas" style="z-index:2"></canvas>

<script type="text/javascript">

/*
		 * On page load
		 */
		var canvas = document.getElementById("bezier-canvas");
		var context = canvas.getContext('2d');
		var t;
		var bubbles = new Array();
		var bubble_density = 0.0125;
		var start_bubbles = 0;

		$(window).load(function(e) {				
			/*
			 * Set up canvases
			 */
			canvas.width = document.documentElement.clientWidth;
			canvas.height = window.innerHeight;
			
			/*
			 * Randomly generate bubbles
			 */
			start_bubbles = bubble_density * canvas.width;
			for(var i = 0; i < start_bubbles; i++) {
				generateBubble(false);

			}
		});
		
		
		var is_mouse_down = false;
		var mouse_position = new Object();
		$("*").mousedown(function(event) {
			mouse_position.x = event.pageX;
			mouse_position.y = event.pageY;
			is_mouse_down = true;
		})
		.mouseup(function(event) {
			is_mouse_down = false;
		})
		.mousemove(function(event) {
			//if(is_mouse_down) {
				mouse_position.x = event.pageX;
				mouse_position.y = event.pageY;
			//}
		});
		
		function Bubble(x, y, speed, angle, accel_speed, accel_angle, radius) {
			this.x = x;
			this.y = y;
			this.speed = speed;
			this.angle = angle;
			this.accel_speed = accel_speed;
			this.accel_angle = accel_angle;
			this.radius = radius;
		}

		function generateBubble(at_top, position) {
			if(position == null) {
				radius = Math.random()*50 + 20;
				position = new Object();
				position.x = Math.random() * canvas.width;
				if(at_top) position.y = - radius - 5;
				else position.y = Math.random() * canvas.height;
			}
			else {
				radius = Math.random()*20 + 10;
			}
			var speed = Math.random()*0.5 + 0.25;
			var angle = Math.random()*Math.PI/2 + Math.PI*5/4;
			var accel_speed = 0;
			var accel_angle = 0;
			bubbles.push(new Bubble(position.x, position.y, speed, angle, accel_speed, accel_angle, radius));
		}

		window.requestAnimFrame = (function(callback) {
			return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
			function(callback) {
				window.setTimeout(callback, 1000 / 60);
			};
		})();
		
		var t = 0, d = 0;
		
		var zero = [150, 20, 50, 20, 50, 280, 150, 280, 150, 280, 250, 280, 250, 20, 150, 20];
		var one = [60, 60, 120, 60, 120, 20, 120, 20, 120, 20, 120, 20, 120, 280, 120, 280];
		var two = [60, 120, 160, 20, 290, 120, 60, 280, 60, 280, 60, 280, 200, 280, 200, 280];
		var three = [60, 20, 240, 20, 240, 150, 60, 150, 60, 150, 240, 150, 240, 280, 60, 280];
		var four = [200, 20, 30, 160, 30, 160, 230, 160, 200, 20, 200, 20, 200, 280, 200, 280];
		var five = [200, 20, 80, 20, 100, 20, 100, 100, 100, 100, 230, 100, 230, 200, 100, 200];
		var six = [200, 20, 60, 150, 70, 280, 170, 280, 170, 280, 280, 250, 270, 120, 100, 180];
		var seven = [40, 20, 40, 20, 180, 20, 180, 20, 180, 20, 180, 20, 80, 280, 80, 280];
		var eight = [150, 20, -20, 70, 320, 170, 150, 250, 150, 250, -20, 170, 320, 70, 150, 20];
		var nine = [80, 280, 220, 150, 210, 20, 110, 20, 110, 20, 20, 20, 50, 180, 180, 120];
		var digits = [zero, one, two, three, four, five, six, seven, eight, nine];
	
		var today = new Date();
		var hour = today.getHours();
		var minute = today.getMinutes();
		var second = today.getSeconds();
		var hour1 = (hour - (hour % 10)) / 10;
		var hour2 = hour % 10;
		var minute1 = (minute - (minute % 10)) / 10;
		var minute2 = minute % 10;
		var second1 = (second - (second % 10)) / 10;
		var second2 = second % 10;
		var anim_h1_t = -1, anim_h2_t = -1, anim_m1_t = -1, anim_m2_t = -1, anim_s1_t = -1, anim_s2_t = -1;
		var anim_duration = 125;
		setInterval(function() {
			updateSecond2();
		}, 1000);
		
		function updateSecond2() {
			second2 = (second2 + 1)%10;
			anim_s2_t = 0;
			if(second2 == 0) updateSecond1();
		}
		function updateSecond1() {
			second1 = (second1 + 1)%6;
			anim_s1_t = 0;
			if(second1 == 0) updateMinute2();
		}
		function updateMinute2() {
			minute2 = (minute2 + 1)%10;
			anim_m2_t = 0;
			if(minute2 == 0) updateMinute1();
		}
		function updateMinute1() {
			minute1 = (minute1 + 1)%6;
			anim_m1_t = 0;
			if(minute1 == 0) updateHour2();
		}
		function updateHour2() {
			hour2 = (hour2 + 1)%10;
			anim_h2_t = 0;
			if(hour2 == 0) updateHour1();
		}
		function updateHour1() {
			hour1 = (hour1 + 1)%10;
			anim_h1_t = 0;
		}
		
		function linearTween(t, b, c, d) {
			return c*t/d + b;
		}
		function easeInOutQuart(t, b, c, d) {
			t /= d/2;
			if (t < 1) return c/2*t*t*t*t + b;
			t -= 2;
			return -c/2 * (t*t*t*t - 2) + b;
		}
		function arrCopy(arr) {
			var newArr = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
			for(var arrI=0; arrI<arr.length; arrI++) {
				newArr[arrI] = arr[arrI];
			}
			console.log(newArr);
			return newArr;
		}
		function animate() {
			
			// update
			var now = new Date().getTime();
	        var dt = now - (t || now);		 
		    t = now;
		    
			var new_bubble_rate = 0.0125;
			//if(bubbles.length == 0) new_bubble_rate = 1;
			//else new_bubble_rate = 0.05 * start_bubbles/(bubbles.length * bubbles.length);
		    
			if(Math.random()<new_bubble_rate) generateBubble(true);

			// clear
			context.save();
			context.setTransform(1, 0, 0, 1, 0, 0);
			context.clearRect(0, 0, canvas.width, canvas.height);
			context.restore();
			
			
			context.strokeStyle = "rgba(255, 255, 255, 0.7)";
			for(var i = 0; i < bubbles.length; i++) {
				var bubble = bubbles[i];
				context.beginPath();
				context.arc(bubble.x, bubble.y, bubble.radius, 0, 2*Math.PI);
				context.closePath();
				context.stroke();
				
				bubble.x += bubble.speed * Math.cos(bubble.angle);
				bubble.y -= bubble.speed * Math.sin(bubble.angle);
				
/*				if(is_mouse_down) {
					//bubble.angle = Math.atan((mouse_position.x - bubble.x) / (mouse_position.y - bubble.y));
//					bubble.accelx = (mouse_position.x - bubble.x)/100/bubble.radius;
//					bubble.accely = (mouse_position.y - bubble.y)/100/bubble.radius;
				}
				else {
					//bubble.accel_angle = 0;
//					bubble.accelx = 0;
//					bubble.accely = 0;
				}
*/
				bubble.speed += bubble.accel_speed;
				bubble.angle += bubble.accel_angle;				
//				bubble.velx += bubble.accelx;
//				bubble.vely += bubble.accely;
				
				if(bubble.x < -bubble.radius-6 || bubble.x > canvas.width+bubble.radius+6 ||
					bubble.y < -bubble.radius-6 || bubble.y > canvas.height+bubble.radius+6) {
					bubbles.splice(i, 1);
					i--;
				}
			}

			var hourPoints1 = arrCopy(digits[hour1]);
			var hourPoints2 = arrCopy(digits[hour2]);
			var minutePoints1 = arrCopy(digits[minute1]);
			var minutePoints2 = arrCopy(digits[minute2]);
			var secondPoints1 = arrCopy(digits[second1]);
			var secondPoints2 = arrCopy(digits[second2]);
			
			
			if(anim_h1_t > -1) {
				var start = (hour1 + 9)%digits.length; // (hour1 - 1)
				var end = (start + 1)%digits.length;
				for(var p = 0; p < 16; p++) {
					hourPoints1[p] = easeInOutQuart(anim_h1_t, digits[start][p], digits[end][p] - digits[start][p], anim_duration);
				}
			}
			if(anim_h2_t > -1) {
				var start = (hour2 + 9)%digits.length;
				var end = (start + 1)%digits.length;
				for(var p = 0; p < 16; p++) {
					hourPoints2[p] = easeInOutQuart(anim_h2_t, digits[start][p], digits[end][p] - digits[start][p], anim_duration);
				}
			}
			if(anim_m1_t > -1) {
				var start = (minute1 + 5)%6;
				var end = (start + 1)%6;
				for(var p = 0; p < 16; p++) {
					minutePoints1[p] = easeInOutQuart(anim_m1_t, digits[start][p], digits[end][p] - digits[start][p], anim_duration);
				}
			}
			if(anim_m2_t > -1) {
				var start = (minute2 + 9)%digits.length;
				var end = (start + 1)%digits.length;
				for(var p = 0; p < 16; p++) {
					minutePoints2[p] = easeInOutQuart(anim_m2_t, digits[start][p], digits[end][p] - digits[start][p], anim_duration);
				}
			}
			if(anim_s1_t > -1) {
				var start = (second1 + 5)%6;
				var end = (start + 1)%6;
				for(var p = 0; p < 16; p++) {
					secondPoints1[p] = easeInOutQuart(anim_s1_t, digits[start][p], digits[end][p] - digits[start][p], anim_duration);
				}
			}
			if(anim_s2_t > -1) {
				var start = (second2 + 9)%digits.length;
				var end = (start + 1)%digits.length;
				for(var p = 0; p < 16; p++) {
					secondPoints2[p] = easeInOutQuart(anim_s2_t, digits[start][p], digits[end][p] - digits[start][p], anim_duration);
				}
			}
			
			var scale = (document.documentElement.clientWidth * 0.8)/1300;
			var points = hourPoints1;
			var x_offset = document.documentElement.clientWidth * 0.1;//(document.documentElement.clientWidth - 1300)/2;
			var y_offset = (window.innerHeight - 300)/3;
			context.strokeStyle = "rgba(0, 0, 0, 1.0)";
			context.lineWidth = 10;
			context.lineCap = "round";
			for(var i=0; i<6; i++) { // Loop through each number in the clock
				if(!(i == 0 && hour1 == 0)) {
					context.beginPath();
					context.moveTo(points[0]*scale + x_offset, points[1]*scale + y_offset);
					context.bezierCurveTo(points[2]*scale + x_offset, points[3]*scale + y_offset, points[4]*scale + x_offset, points[5]*scale + y_offset, points[6]*scale + x_offset, points[7]*scale + y_offset);
					context.moveTo(points[8]*scale + x_offset, points[9]*scale + y_offset);
					context.bezierCurveTo(points[10]*scale + x_offset, points[11]*scale + y_offset, points[12]*scale + x_offset, points[13]*scale + y_offset, points[14]*scale + x_offset, points[15]*scale + y_offset);
					context.stroke();
				}
				
				switch(i) {
					case 0:
						if(hour1 == 1) x_offset += 100*scale;
						else x_offset += 250*scale;
						points = hourPoints2;
						break;
					case 1:
						x_offset += 250*scale;
						points = minutePoints1;
						break;
					case 2:
						var add_x = 0;
						if(minute1 == 1) add_x += 100*scale;
						else add_x += 200*scale;
						
						
						x_offset += add_x/5;
						context.beginPath();
						context.arc(x_offset, y_offset + 100*scale, 5, 5, 0, 2*Math.PI);
						context.closePath();
						context.fill();
						context.beginPath();
						context.arc(x_offset, y_offset + 200*scale, 5, 5, 0, 2*Math.PI);
						context.closePath();
						context.fill();
						x_offset += 4*add_x/5;
						
						points = minutePoints2;
						break;
					case 3:
						x_offset += 250*scale;
						points = secondPoints1;
						break;
					case 4:
						var add_x = 0;
						if(second1 == 1) add_x += 100*scale;
						else add_x += 200*scale;
						
						
						x_offset += add_x/5;
						context.beginPath();
						context.arc(x_offset, y_offset + 100*scale, 5, 5, 0, 2*Math.PI);
						context.closePath();
						context.fill();
						context.beginPath();
						context.arc(x_offset, y_offset + 200*scale, 5, 5, 0, 2*Math.PI);
						context.closePath();
						context.fill();
						x_offset += 4*add_x/5;
						
						points = secondPoints2;
				}
			}
			
			if(anim_h1_t > -1) {
				anim_h1_t++;
				if(anim_h1_t > anim_duration) anim_h1_t = -1;
			}
			if(anim_h2_t > -1) {
				anim_h2_t++;
				if(anim_h2_t > anim_duration) anim_h2_t = -1;
			}
			if(anim_m1_t > -1) {
				anim_m1_t++;
				if(anim_m1_t > anim_duration) anim_m1_t = -1;
			}
			if(anim_m2_t > -1) {
				anim_m2_t++;
				if(anim_m2_t > anim_duration) anim_m2_t = -1;
			}
			if(anim_s1_t > -1) {
				anim_s1_t++;
				if(anim_s1_t > anim_duration) anim_s1_t = -1;
			}
			if(anim_s2_t > -1) {
				anim_s2_t++;
				if(anim_s2_t > anim_duration) anim_s2_t = -1;
			}
			
			// request new frame
			requestAnimFrame(animate);
		}
		animate();

</script>

</body>

</html>
